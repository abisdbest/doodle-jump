<!DOCTYPE html>
<html>
<head>
<title>Basic Doodle Jump HTML Game</title>
<meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
html, body {
    height: 100%;
    margin: 0;
}
body {
    display: flex;
    align-items: center;
    justify-content: center;
}
canvas {
    border: 1px solid black;
}
#score {
    position: fixed;
    left: calc(50% - 420px);
    top: 40px;
    background-color: white;
    width: 70px;
    text-align: center;
}
</style>
</head>
<body>
<canvas width="900" height="800" id="game"></canvas>
<span id="score">0</span>
<script>
var tickRate = 30;
var score = 0
var keyDown = {};
var keyMap = {
    37: 'left',
    38: 'up',
    39: 'right',
    40: 'down'
};

$('body').keydown(function (e) {
    keyDown[keyMap[e.which]] = true;
});

$('body').keyup(function (e) {
    keyDown[keyMap[e.which]] = false;
});

const canvas = document.getElementById('game'); 
const context = canvas.getContext('2d');

const platformImage = new Image();
platformImage.src = 'platform.png'; 

const blueplatformImage = new Image();
blueplatformImage.src = 'blue platform.png'; 

const whiteplatformImage = new Image();
whiteplatformImage.src = 'white platform.png'; 

const brownplatformImage = new Image();
brownplatformImage.src = 'brown platform.png'; 

const doodleImage = new Image();
doodleImage.src = 'doodle normal.png'; 

const backgroundImage = new Image();
backgroundImage.src = 'backround.png';

const springImage = new Image();
springImage.src = 'spring.png'; 

const jetpackImage = new Image();
jetpackImage.src = 'jetpack.png'; 

const flyinghatImage = new Image();
flyinghatImage.src = 'flying hat.png'; 

const platformWidth = 65;
const platformHeight = 20;
const platformStart = canvas.height - 50;

const gravity = 0.33;
const drag = 0.3;
const bounceVelocity = -12.5;

let minPlatformSpace = 15;
let maxPlatformSpace = 20;

let platforms = [{
    x: canvas.width / 2 - platformWidth / 2,
    y: platformStart,
    type: 'normal'
}];

function random(min, max) {
    return Math.random() * (max - min) + min;
}

let y = platformStart;
while (y > 0) {
    y -= platformHeight + random(minPlatformSpace, maxPlatformSpace);
    let x;
    do {
        x = random(25, canvas.width - 25 - platformWidth);
    } while (y > canvas.height / 2 && x > canvas.width / 2 - platformWidth * 1.5 && x < canvas.width / 2 + platformWidth / 2);

    let platformType = 'normal'; // Default type
    if (score > 1000) {  // Example: After score 100, new platform types
        if (Math.random() < 0.05) {
            platformType = 'brown';
        } else if (Math.random() < 0.02) {
            platformType = 'blue';
        } else if (Math.random() < 0.03) {
            platformType = 'white';
        } else {
            platformType = 'normal';
        }
    }

    platforms.push({ x, y, type: platformType });
}

const doodle = {
    width: 60,
    height: 60,
    x: canvas.width / 2 - 20,
    y: platformStart - 60,
    dx: 0,
    dy: 0,
    previousY: platformStart - 60
};

let playerDir = 0;
let keydown = false;
let prevDoodleY = doodle.y;

function resetGame() {
    score = 0;
    doodle.x = canvas.width / 2 - 20;
    doodle.y = platformStart - 60;
    doodle.dx = 0;
    doodle.dy = 0;
    playerDir = 0;
    minPlatformSpace = 15;
    maxPlatformSpace = 20;

    platforms = [{ x: canvas.width / 2 - platformWidth / 2, y: platformStart, type: 'normal' }];
    let y = platformStart;
    while (y > 0) {
        y -= platformHeight + random(minPlatformSpace, maxPlatformSpace);
        let x;
        do {
            x = random(25, canvas.width - 25 - platformWidth);
        } while (y > canvas.height / 2 && x > canvas.width / 2 - platformWidth * 1.5 && x < canvas.width / 2 + platformWidth / 2);
        platforms.push({ x, y, type: 'normal' });
    }
    document.getElementById("score").innerText = score;
}

function loop() {
    requestAnimationFrame(loop);
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

    doodle.dy += gravity;
    if (doodle.y > canvas.height) {
        alert("Game Over!");
        resetGame();
    }

    if (doodle.y < canvas.height / 2 && doodle.dy < 0) {
        platforms.forEach(function(platform) {
            platform.y += -doodle.dy;
        });
        document.getElementById("score").innerText = Math.round(score);

        while (platforms[platforms.length - 1].y > 0) {
            let platformType = 'normal';
            if (score > 100) {
                if (Math.random() < 0.2) platformType = 'brown';
                else if (Math.random() < 0.3) platformType = 'blue';
                else if (Math.random() < 0.4) platformType = 'white';
            }

            platforms.push({
                x: random(25, canvas.width - 25 - platformWidth),
                y: platforms[platforms.length - 1].y - (platformHeight + random(minPlatformSpace, maxPlatformSpace)),
                type: platformType
            });
            minPlatformSpace += 0.03;
            maxPlatformSpace += 0.03;
            maxPlatformSpace = Math.min(maxPlatformSpace, canvas.height / 2);
        }
    } else {
        doodle.y += doodle.dy;
    }

    if (!keydown) {
        if (playerDir < 0) {
            doodle.dx += drag;
            if (doodle.dx > 0) {
                doodle.dx = 0;
                playerDir = 0;
            }
        } else if (playerDir > 0) {
            doodle.dx -= drag;
            if (doodle.dx < 0) {
                doodle.dx = 0;
                playerDir = 0;
            }
        }
    }

    doodle.x += doodle.dx;

    if (doodle.x + doodle.width < 0) {
        doodle.x = canvas.width;
    } else if (doodle.x > canvas.width) {
        doodle.x = -doodle.width;
    }

    platforms.forEach(function(platform) {
        // Check platform type
        if (platform.type === 'blue') {
            // Move blue platforms side to side
            platform.x += random(-1, 1); // This will make the blue platforms move slightly in either direction

            // You can also set limits to prevent the platform from moving off-screen
            if (platform.x < 0) platform.x = 0;
            if (platform.x + platformWidth > canvas.width) platform.x = canvas.width - platformWidth;
        }

        context.drawImage(platformImage, platform.x, platform.y, platformWidth, platformHeight);

        // Handle collision with doodle (same as before)
        if (doodle.dy > 0 && prevDoodleY + doodle.height <= platform.y &&
            doodle.x < platform.x + platformWidth && doodle.x + doodle.width > platform.x &&
            doodle.y < platform.y + platformHeight && doodle.y + doodle.height > platform.y) {

            if (platform.type === 'brown') {
                // Brown platforms disappear when touched
                platforms = platforms.filter(p => p !== platform);
            } else if (platform.type === 'white') {
                // White platforms bounce once and disappear
                doodle.dy = bounceVelocity;
                platforms = platforms.filter(p => p !== platform); // Remove white platform after bounce
            } else if (platform.type === 'blue') {
                // Bounce on blue platform, but also move side to side
                doodle.dy = bounceVelocity;
            } else {
                // Regular platform bounce
                doodle.dy = bounceVelocity;
            }

            doodle.y = platform.y - doodle.height; // Reset doodle position after landing
        }

        // Handle power-ups (spring, jetpack, flyinghat) as before
        if (platform.powerup === "spring" && doodle.dy > 0 &&
            doodle.x < platform.x + platformWidth && doodle.x + doodle.width > platform.x &&
            doodle.y < platform.y - 60 && doodle.y + doodle.height > platform.y - 20) {
            doodle.dy = bounceVelocity * 1.5;
        } else if (platform.powerup === "jetpack" && doodle.dy > 0 &&
            doodle.x < platform.x + platformWidth && doodle.x + doodle.width > platform.x &&
            doodle.y < platform.y - 60 && doodle.y + doodle.height > platform.y - 20) {
            doodle.dy = bounceVelocity * 6;
        } else if (platform.powerup === "flyinghat" && doodle.dy > 0 &&
            doodle.x < platform.x + platformWidth && doodle.x + doodle.width > platform.x &&
            doodle.y < platform.y - 60 && doodle.y + doodle.height > platform.y - 20) {
            doodle.dy = bounceVelocity * 4;
        }
    });

    // Draw doodle
    context.drawImage(doodleImage, doodle.x, doodle.y, doodle.width, doodle.height);
    
    let verticalDistance = doodle.y - doodle.previousY;
    if (verticalDistance < 0) { // Only increment score when moving upwards
        score += Math.abs(verticalDistance) * 0.01; // Adjust the multiplier to control score speed
    }
    prevDoodleY = doodle.y;

    // Remove offscreen platforms
    platforms = platforms.filter(function(platform) {
        return platform.y < canvas.height;
    });
}

document.addEventListener('keyup', function (e) {
    keydown = false;
});

var tick = function () {
    if (keyDown['left']) {
        keydown = true; 
        playerDir = -1;
        doodle.dx = -5;
    }
    if (keyDown['right']) {
        keydown = true;
        playerDir = 1;
        doodle.dx = 5;
    }
    setTimeout(tick, tickRate);
};

tick();
// start the game loop
requestAnimationFrame(loop);
</script>
</body>
</html>
